<!DOCTYPE html>
<html>

<head>
    <title>Calculator</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="./CSS/style.css" />
</head>

<body>
    <h1>Calculator</h1>
    <div id="calculator-container">
        <div id="display">0</div>
        <div id="button-container">
            <button id="backspace">&lsaquo;</button>
            <button id="clear">C</button>
            <button id="sign">(-)</button>
            <button class="operators" id="divide">/</button>
            <button class="numbers" value="7"><kbd>7</kbd></button>
            <button class="numbers" value="8">8</button>
            <button class="numbers" value="9">9</button>
            <button class="operators" id="multiply">x</button>
            <button class="numbers" value="4">4</button>
            <button class="numbers" value="5">5</button>
            <button class="numbers" value="6">6</button>
            <button class="operators" id="subtract">-</button>
            <button class="numbers" value="1">1</button>
            <button class="numbers" value="2">2</button>
            <button class="numbers" value="3">3</button>
            <button class="operators" id="add">+</button>
            <button class="numbers" id="zero" value="0">0</button>
            <button class="numbers" value=".">.</button>
            <button class="operators" id="equals">=</button>
        </div>
    </div>
    <script type="application/javascript">
        const add = (x, y) => x + y;
        const subtract = (x, y) => x - y;
        const multiply = (x, y) => x * y;
        const divide = (x, y) => {
            if (y === 0) {
                clearDisplay = true;
                divideByZero = true;
                console.log('divide by zero');
                return 0;
            }
            return x / y;
        };
        const equals = (x, y) => x;
        // const operate = (operation, x, y) => operation(x, y);
        const operate = (operation, x, y) => {
            if (operation === 'add') return add(x, y);
            else if (operation === 'subtract') return subtract(x, y);
            else if (operation === 'multiply') return multiply(x, y);
            else if (operation === 'divide') return divide(x, y);
            else if (operation === 'equals') return equals(x, y);
        };
        const display = document.querySelector('#display');
        const numbers = document.querySelectorAll('.numbers');
        const operators = document.querySelectorAll('.operators');
        const clearButton = document.querySelector('#clear');
        const backspace = document.querySelector('#backspace');
        const keys = Array.from(document.querySelectorAll('kbd'));

        // keys.forEach(key = {
        //     key.addEventListener('click', () => {

        //     })
        // })


        const clear = () => { //reset everything
            currentOperator = '';
            previousOperator = '';
            displayValue = '';
            currentValue = '';
            display.textContent = '0';
            x = '';
            y = '';
            answer = 0;
            divideByZero = false;
            tooLong = false;
            clearMem = false;
        };
        const sign = document.querySelector('#sign');
        const equalButton = document.querySelector('#equals');
        let displayValue = '0';
        let displaySize = 7;
        let currentValue = '';
        let clearDisplay;
        let x = '';
        let y = '';
        let previousOperator = '';
        let currentOperator = '';
        let answer;
        let enteredNumber; //last button pressed was a number
        let divideByZero = false; //received an error
        let tooLong = false;
        let clearMem = false; //starting a new operation
        // const decimalCheck = /^\d+\.[1-9]\d*$/;

        const updateDisplay = function (value) {
            if ((value !== '.' && display.textContent === '0') || clearDisplay) {
                currentValue = '';
                display.textContent = currentValue;
                clearDisplay = false;
                currentValue += value;
                display.textContent = currentValue;
            } else if (!(value === '.' && currentValue.includes('.')) && currentValue.length <= displaySize) {
                console.log(`length is ${currentValue.length}`);
                console.log(`type is ${typeof (currentValue)}`);
                currentValue += value;
                display.textContent += value;
            }

        };

        numbers.forEach(number => {
            number.addEventListener('click', () => {
                if (clearMem) clear(); //starting a new calculation              
                if (divideByZero) clear(); //starting over after error
                updateDisplay(number.value);
                y = Number(currentValue);
                enteredNumber = true; //last button pushed was a number
            })
        });

        operators.forEach(operator => {
            operator.addEventListener('click', () => {
                clearDisplay = true;

                if (clearMem) clearMem = false; //doesn't clear memory if you click on another operator after equals

                if (divideByZero) clear();

                if (currentOperator === '' || currentOperator === 'equals') {
                    currentOperator = operator.id;
                } else {
                    previousOperator = currentOperator;
                    currentOperator = operator.id;
                }

                if (x === '') {
                    x = y; //shift the previous number to x
                } else if ((enteredNumber || currentOperator === 'equals') && previousOperator !== '') {
                    answer = operate(previousOperator, x, y);
                    if (divideByZero) {
                        answer = 'NO BUENO';
                    } else if (answer.toString().length > displaySize) {
                        answer = 'TOO LONG';
                        tooLong = true;
                    }
                    x = answer;
                    currentValue = answer;
                    updateDisplay(answer);
                    if (answer !== 'NO BUENO' && answer !== 'TOO LONG') {
                        x = answer;
                    }
                    clearDisplay = true;
                    if (currentOperator === 'equals') {
                        clearMem = true; //reset x and y to 0
                    } else {
                        clearMem = false; //keep numbers in memory
                    }
                }

                enteredNumber = false; //last button pushed was an operator

            })
        });

        clearButton.addEventListener('click', () => clear());

        sign.addEventListener('click', () => {
            x = Number(currentValue);
            answer = operate('multiply', currentValue, (-1));
            y = answer;
            x = '';
            currentValue = answer;
            display.textContent = currentValue;
            console.log(currentValue);
        });

        backspace.addEventListener('click', () => {
                if (divideByZero || tooLong) {
                    clear();
                } else {
                    currentValue = currentValue.toString().slice(0, -1);
                    y = Number(currentValue);
                    if (currentValue === '' || currentValue === '-') {
                        currentValue = '0';
                    }
                    display.textContent = currentValue;
                }

                enteredNumber = true;
            });


    </script>
</body>

</html>