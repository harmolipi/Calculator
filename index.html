<!DOCTYPE html>
<html>

<head>
    <title>Calculator</title>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="./CSS/style.css" />
</head>

<body>
    <h1>Calculator</h1>
    <div id="calculator-container">
        <div id="display">0</div>
        <div id="button-container">
            <button id="backspace" value="Backspace">&lsaquo;</button>
            <button id="clear" value="Delete">C</button>
            <button id="sign" value="sign">(-)</button>
            <button class="operators" id="divide" value="/">/</button>
            <button class="numbers" value="7"><kbd>7</kbd></button>
            <button class="numbers" value="8"><kbd>8</kbd></button>
            <button class="numbers" value="9">9</button>
            <button class="operators" id="multiply" value="*">x</button>
            <button class="numbers" value="4">4</button>
            <button class="numbers" value="5">5</button>
            <button class="numbers" value="6">6</button>
            <button class="operators" id="subtract" value="-">-</button>
            <button class="numbers" value="1">1</button>
            <button class="numbers" value="2">2</button>
            <button class="numbers" value="3">3</button>
            <button class="operators" id="add" value="+">+</button>
            <button class="numbers" id="zero" value="0">0</button>
            <button class="numbers" value=".">.</button>
            <button class="operators" id="equals" value="Enter">=</button>
        </div>
    </div>
    <script type="application/javascript">
        const add = (x, y) => x + y;
        const subtract = (x, y) => x - y;
        const multiply = (x, y) => x * y;
        const divide = (x, y) => {
            if (y === 0) {
                clearDisplay = true;
                divideByZero = true;
                console.log('divide by zero');
                return 0;
            }
            return x / y;
        };
        const equals = (x, y) => {
            console.log('equalling1');
            x;
        }
        // const operate = (operation, x, y) => operation(x, y);
        // const operate = (operation, x, y) => {
        //     if (operation === 'add') return add(x, y);
        //     else if (operation === 'subtract') return subtract(x, y);
        //     else if (operation === 'multiply') return multiply(x, y);
        //     else if (operation === 'divide') return divide(x, y);
        //     else if (operation === 'equals') return equals(x, y);
        // };
        const operate = (operation, x, y) => {
            switch (operation) {
                case 'add':
                    return add(x, y);
                case 'subtract':
                    return subtract(x, y);
                case 'multiply':
                    return multiply(x, y);
                case 'divide':
                    return divide(x, y);
                case 'equals':
                    return equals(x, y);
            }
        };
        const display = document.querySelector('#display');
        const numbers = document.querySelectorAll('.numbers');
        const operators = document.querySelectorAll('.operators');
        const clearButton = document.querySelector('#clear');
        const backspace = document.querySelector('#backspace');
        const buttons = Array.from(document.querySelectorAll('button'));
        const numberList = /[\d\.]/;
        const operatorList = /[+-/*]/;

        numbers.forEach(number => number.addEventListener('keyup', (e) => {
            if (e.propertyName !== 'number-click') return;
            e.target.classList.remove('number-click');
        }));

        const buttonDownAction = (e) => {
            console.log(`Key pressed is ${e.key} and type is ${typeof(e.key)}`);
            const thisButton = document.querySelector(`[value="${e.key}"]`);
            const thisKey = thisButton.value;
            console.log(`This key is ${thisKey}`);
            console.log(e.key);
            console.log(thisButton);

            if (numberList.test(thisKey)) {
                thisButton.classList.add('number-click');
                numberPress(thisKey);
                console.log(`This is entered number: ${enteredNumber}`);
            } else {
                switch (thisKey) {
                    case '+':
                        thisButton.classList.add('operator-click');
                        console.log('plus button');
                        operatorPress('add');
                        break;
                    case '-':
                        thisButton.classList.add('operator-click');
                        operatorPress('subtract');
                        break;
                    case '*':
                        thisButton.classList.add('operator-click');
                        operatorPress('multiply');
                        break;
                    case '/':
                        thisButton.classList.add('operator-click');
                        operatorPress('divide');
                        break;
                    case 'Enter':
                        thisButton.classList.add('operator-click');
                        console.log('enter button');
                        operatorPress('equals');
                        break;
                    case 'Backspace':
                        console.log('backspace');
                        thisButton.classList.add('backspace-click');
                        backspaceCharacters();
                        break;
                    case 'Delete':
                        thisButton.classList.add('number-click');
                        clear();
                        break;
                }
            }

        };

        const buttonUpAction = (e) => {
            const thisButton = document.querySelector(`[value="${e.key}"]`);
            if (thisButton.classList.contains('number-click')) {
                thisButton.classList.remove('number-click');
            } else if (thisButton.classList.contains('operator-click')) {
                thisButton.classList.remove('operator-click');
            } else if (thisButton.classList.contains('backspace-click')) {
                console.log('removing backspace-click');
                thisButton.classList.remove('backspace-click');
            }
        }

        window.addEventListener('keydown', buttonDownAction);

        window.addEventListener('keyup', buttonUpAction);

        const clear = () => { //reset everything
            currentOperator = '';
            previousOperator = '';
            displayValue = '';
            currentValue = '';
            display.textContent = '0';
            x = '';
            y = '';
            answer = 0;
            divideByZero = false;
            tooLong = false;
            clearMem = false;
        };
        const sign = document.querySelector('#sign');
        const equalButton = document.querySelector('#equals');
        let displayValue = '0';
        let displaySize = 7;
        let currentValue = '';
        let clearDisplay;
        let x = '';
        let y = '';
        let previousOperator = '';
        let currentOperator = '';
        let answer;
        let enteredNumber; //last button pressed was a number
        let divideByZero = false; //received an error
        let tooLong = false;
        let clearMem = false; //starting a new operation
        // const decimalCheck = /^\d+\.[1-9]\d*$/;

        const updateDisplay = function (value) {
            if ((value !== '.' && display.textContent === '0') || clearDisplay) {
                currentValue = '';
                display.textContent = currentValue;
                clearDisplay = false;
                currentValue += value;
                display.textContent = currentValue;
            } else if (!(value === '.' && currentValue.includes('.')) && currentValue.length <= displaySize) {
                currentValue += value;
                display.textContent += value;
            }

        };

        const numberPress = num => {
            if (clearMem) clear(); //starting a new calculation           
            if (divideByZero) clear(); //starting over after error
            updateDisplay(num);
            y = Number(currentValue);
            enteredNumber = true; //last button pushed was a number
        }

        const operatorPress = operator => {
                console.log(operator);
                clearDisplay = true;

                if (clearMem) clearMem = false; //doesn't clear memory if you click on another operator after equals

                if (divideByZero) clear();

                if (currentOperator === '' || currentOperator === 'equals') {
                    currentOperator = operator;
                } else {
                    previousOperator = currentOperator;
                    currentOperator = operator;
                    console.log('double equals');
                }

                if (x === '') {
                    x = y; //shift the previous number to x
                } else if ((enteredNumber || currentOperator === 'equals') && previousOperator !== '') {
                    // answer = operate(previousOperator, x, y);
                    answer = Math.round((operate(previousOperator, x, y) * 100)) / 100;
                    if (divideByZero) {
                        answer = 'NO BUENO';
                    } else if (answer.toString().length > displaySize) {
                        answer = 'TOO LONG';
                        tooLong = true;
                    }
                    // x = answer;
                    currentValue = answer;
                    updateDisplay(answer);
                    if (answer !== 'NO BUENO' && answer !== 'TOO LONG') {
                        x = answer;
                    }
                    clearDisplay = true;
                    if (currentOperator === 'equals') {
                        clearMem = true; //reset x and y to 0
                    } else {
                        clearMem = false; //keep numbers in memory
                    }
                }

                enteredNumber = false; //last button pushed was an operator
            };

        numbers.forEach(number => {
            number.addEventListener('click', () => {
                numberPress(number.value);
            })
        });

        operators.forEach(operator => {
            operator.addEventListener('click', () => {
                console.log(`Operator ID is ${operator.id}`);
                operatorPress(operator.id);
            })
        });

        clearButton.addEventListener('click', () => clear());

        const signChange = () => {
            x = Number(currentValue);
            answer = operate('multiply', currentValue, (-1));
            y = answer;
            x = '';
            currentValue = answer;
            display.textContent = currentValue;
        }

        sign.addEventListener('click', () => {
            signChange();
            // x = Number(currentValue);
            // answer = operate('multiply', currentValue, (-1));
            // y = answer;
            // x = '';
            // currentValue = answer;
            // display.textContent = currentValue;
            // console.log(currentValue);
        });

        const backspaceCharacters = () => {
            if (divideByZero || tooLong) {
                    clear();
                } else {
                    currentValue = currentValue.toString().slice(0, -1);
                    if (currentValue === '' || currentValue === '-') {
                        currentValue = '0';
                    }
                    y = Number(currentValue);
                    x = '';
                    display.textContent = currentValue;
                }
                enteredNumber = true;
        };

        backspace.addEventListener('click', backspaceCharacters);


    </script>
</body>

</html>